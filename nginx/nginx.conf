worker_processes  1;

events {
  worker_connections  1024;
}

http {
  include       mime.types;
  default_type  application/octet-stream;

  # Optional: Rate limiting zone (5 requests/sec per client IP)
  limit_req_zone $binary_remote_addr zone=perip:10m rate=1r/s;
  limit_req_status 429;

  sendfile        on;
  keepalive_timeout  65;

  # Server 1: returns custom HTML on port 8080
  server {
    listen 8080;
    server_name _;

    location / {
      # Optional: Apply rate limiting
      add_header X-RateLimit-Debug "enabled" always;
      limit_req zone=perip burst=1 nodelay;

      root /var/www/html;
      index index.html;
      add_header Content-Type text/html;
    }
  }

  # Server 2: returns an error on port 8081
  server {
    listen 8081;
    server_name _;

    location / {
      return 500 "Intentional error server\n";
    }
  }

  # Optional: HTTPS server on port 8443 (self-signed)
  server {
    listen 8443 ssl;
    server_name _;

    ssl_certificate     /etc/nginx/certs/server.crt;
    ssl_certificate_key /etc/nginx/certs/server.key;

    location / {
      # Optional: Apply rate limiting
      limit_req zone=perip burst=10 nodelay;

      root /var/www/html;
      index index.html;
      add_header Content-Type text/html;
    }
  }
}
